import{s as _}from"./project.config-DUfbQKeR.js";import{j as f,k as v,m as S,n as B,o as T,r as $,p as M,q as W,t as R,v as O,w as P,x as V,y as j,Z as U,z as Z,A as H,B as k}from"./main-lEEsSsVM.js";import"./supabase-DjCBILTv.js";import"./pdf-yBvge-Eo.js";function F(e){return new Promise(a=>{const r=document.createElement("div");r.className="slusar-confirm-overlay";const s=document.createElement("div");s.className="slusar-confirm-modal";const t=document.createElement("div");t.className="slusar-confirm-message",t.textContent=e;const c=document.createElement("div");c.className="slusar-confirm-buttons";const n=document.createElement("button");n.className="slusar-confirm-btn slusar-confirm-ok",n.textContent="–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏",n.onclick=()=>{document.body.removeChild(r),a(!0)};const i=document.createElement("button");i.className="slusar-confirm-btn slusar-confirm-cancel",i.textContent="–í—ñ–¥–º—ñ–Ω–∏—Ç–∏",i.onclick=()=>{document.body.removeChild(r),a(!1)},c.appendChild(n),c.appendChild(i),s.appendChild(t),s.appendChild(c),r.appendChild(s),document.body.appendChild(r),setTimeout(()=>n.focus(),100);const o=l=>{l.key==="Escape"&&(document.body.removeChild(r),document.removeEventListener("keydown",o),a(!1))};document.addEventListener("keydown",o)})}async function G(e,a,r,s,t,c){try{const n={act_id:e,act_number:a,completed_by_surname:s,completed_by_name:t||null,pruimalnyk:c||null,viewed:!1,delit:!1,data:new Date().toISOString()},{error:i}=await _.from("slusar_complete_notifications").insert([n]);if(i)return}catch{}}async function J(e){try{const{error:a}=await _.from("slusar_complete_notifications").update({delit:!0}).eq("act_id",e).eq("delit",!1);if(a){a.code!=="PGRST116"&&console.debug("‚ÑπÔ∏è [SlusarNotification] –¢–∞–±–ª–∏—Ü—è slusar_complete_notifications –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ (–Ω–µ –æ–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω–∞)");return}}catch{}}function N(e){return(e??"").replace(/\u00A0/g," ").trim()}function C(e){const a=N(e).replace(/\s/g,"").replace(",","."),r=parseFloat(a);return isFinite(r)?r:0}function A(e){if(!e)return null;const a=new Date(e);if(isNaN(+a))return null;const r=a.getFullYear(),s=String(a.getMonth()+1).padStart(2,"0"),t=String(a.getDate()).padStart(2,"0");return`${r}-${s}-${t}`}async function I(e){const{data:a,error:r}=await _.from("acts").select("date_on, date_off").eq("act_id",e).single();return r?(console.warn("–ù–µ –≤–¥–∞–ª–æ—Å—è –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ –¥–∞—Ç–∏ –∞–∫—Ç—É:",r.message),{date_on:null,date_off:null}):{date_on:(a==null?void 0:a.date_on)??null,date_off:(a==null?void 0:a.date_off)??null}}async function Y(e){if(e.length===0)return new Map;const{data:a,error:r}=await _.from("sclad").select("sclad_id, rahunok, time_off").in("sclad_id",Array.from(new Set(e)));if(r)return console.warn("fetchScladMeta():",r.message),new Map;const s=new Map;for(const t of a||[])s.set(Number(t.sclad_id),{rahunok:t.rahunok??null,time_off:t.time_off??null});return s}async function Q(e){const{data:a,error:r}=await _.from("shops").select("shop_id, data").eq("data->>Name",e).maybeSingle();return r?(console.warn(`fetchShopByName(${e}):`,r.message),null):a?{shop_id:a.shop_id,data:a.data}:null}async function X(e){if(!e.shop_id)return;const{error:a}=await _.from("shops").update({data:e.data}).eq("shop_id",e.shop_id);if(a)throw new Error(`–ù–µ –≤–¥–∞–ª–æ—Å—è –æ–Ω–æ–≤–∏—Ç–∏ shops#${e.shop_id}: ${a.message}`)}function ee(e){return(!e.data||typeof e.data!="object")&&(e.data={}),(!e.data.–Ü—Å—Ç–æ—Ä—ñ—è||typeof e.data.–Ü—Å—Ç–æ—Ä—ñ—è!="object")&&(e.data.–Ü—Å—Ç–æ—Ä—ñ—è={}),e.data.–Ü—Å—Ç–æ—Ä—ñ—è}function D(){const e=[];return document.querySelectorAll(`#${k} tbody tr`).forEach(r=>{const s=r.querySelector('[data-name="name"]');if(!s)return;let t=s.getAttribute("data-type");const c=N(s.textContent);if(!c)return;if(!t||t!=="details"&&t!=="works"){const g=new Set(S.works).has(c),y=new Set(S.details).has(c);t=g&&!y?"works":"details",s.setAttribute("data-type",t)}if(t!=="details")return;const n=r.querySelector('[data-name="id_count"]'),i=r.querySelector('[data-name="price"]'),o=r.querySelector('[data-name="catalog"]'),l=r.querySelector('[data-name="pib_magazin"]'),p=N(o==null?void 0:o.textContent)||null,h=C(n==null?void 0:n.textContent),m=C(i==null?void 0:i.textContent),d=N(l==null?void 0:l.textContent),u=o==null?void 0:o.getAttribute("data-sclad-id"),w=u?Number(u):null;e.push({shopName:d,sclad_id:w,–ù–∞–π–º–µ–Ω—É–≤–∞–Ω–Ω—è:c,–ö–∞—Ç–∞–ª–æ–≥:p,–ö—ñ–ª—å–∫—ñ—Å—Ç—å:h,–¶—ñ–Ω–∞:m})}),e}function te(){const e=[];return document.querySelectorAll(`#${k} tbody tr`).forEach(r=>{const s=r.querySelector('[data-name="name"]');if(!s)return;let t=s.getAttribute("data-type");const c=N(s.textContent);if(!c)return;if(!t||t!=="details"&&t!=="works"){const u=new Set(S.works).has(c),w=new Set(S.details).has(c);t=u&&!w?"works":"details",s.setAttribute("data-type",t)}if(t!=="works")return;const n=r.querySelector('[data-name="id_count"]'),i=r.querySelector('[data-name="price"]'),o=r.querySelector('[data-name="slyusar_sum"]'),l=r.querySelector('[data-name="pib_magazin"]'),p=C(n==null?void 0:n.textContent),h=C(i==null?void 0:i.textContent),m=C(o==null?void 0:o.textContent),d=N(l==null?void 0:l.textContent);e.push({slyusarName:d,–ù–∞–π–º–µ–Ω—É–≤–∞–Ω–Ω—è:c,–ö—ñ–ª—å–∫—ñ—Å—Ç—å:p,–¶—ñ–Ω–∞:h,–ó–∞—Ä–ø–ª–∞—Ç–∞:m})}),e}function ae(){const e=[],a=D(),r=te();for(const s of r){const t=`"${s.–ù–∞–π–º–µ–Ω—É–≤–∞–Ω–Ω—è}"`;(!s.–ö—ñ–ª—å–∫—ñ—Å—Ç—å||s.–ö—ñ–ª—å–∫—ñ—Å—Ç—å===0)&&e.push(`–†–æ–±–æ—Ç–∞ ${t}: –ö-—Ç—å - –Ω–µ –ø–æ—Ä–æ–∂–Ω—ñ–π —ñ –Ω–µ –¥–æ—Ä—ñ–≤–Ω—é—î 0`),(!s.–¶—ñ–Ω–∞||s.–¶—ñ–Ω–∞===0)&&e.push(`–†–æ–±–æ—Ç–∞ ${t}: –¶—ñ–Ω–∞ - –Ω–µ –ø–æ—Ä–æ–∂–Ω—è —ñ –Ω–µ –¥–æ—Ä—ñ–≤–Ω—é—î 0`);const c=s.–ö—ñ–ª—å–∫—ñ—Å—Ç—å*s.–¶—ñ–Ω–∞;(!c||c===0)&&e.push(`–†–æ–±–æ—Ç–∞ ${t}: –°—É–º–∞ - –Ω–µ –ø–æ—Ä–æ–∂–Ω—è —ñ –Ω–µ –¥–æ—Ä—ñ–≤–Ω—é—î 0`);const n=document.querySelector(`#${k} tbody tr [data-name="slyusar_sum"]`);n&&n.offsetParent!==null&&(!s.–ó–∞—Ä–ø–ª–∞—Ç–∞||s.–ó–∞—Ä–ø–ª–∞—Ç–∞===0)&&e.push(`–†–æ–±–æ—Ç–∞ ${t}: –ó–∞—Ä-—Ç–∞ - –Ω–µ –ø–æ—Ä–æ–∂–Ω—è —ñ –Ω–µ –¥–æ—Ä—ñ–≤–Ω—é—î 0`);const i=document.querySelector(`#${k} tbody tr [data-name="pib_magazin"]`);i&&i.offsetParent!==null&&(!s.slyusarName||s.slyusarName.trim()==="")&&e.push(`–†–æ–±–æ—Ç–∞ ${t}: –ü–Ü–ë (–°–ª—é—Å–∞—Ä) - –Ω–µ –ø–æ—Ä–æ–∂–Ω—ñ–π`)}for(const s of a){const t=`"${s.–ù–∞–π–º–µ–Ω—É–≤–∞–Ω–Ω—è}"`;(!s.–ö—ñ–ª—å–∫—ñ—Å—Ç—å||s.–ö—ñ–ª—å–∫—ñ—Å—Ç—å===0)&&e.push(`–î–µ—Ç–∞–ª—å ${t}: –ö-—Ç—å - –Ω–µ –ø–æ—Ä–æ–∂–Ω—ñ–π —ñ –Ω–µ –¥–æ—Ä—ñ–≤–Ω—é—î 0`),(!s.–¶—ñ–Ω–∞||s.–¶—ñ–Ω–∞===0)&&e.push(`–î–µ—Ç–∞–ª—å ${t}: –¶—ñ–Ω–∞ - –Ω–µ –ø–æ—Ä–æ–∂–Ω—è —ñ –Ω–µ –¥–æ—Ä—ñ–≤–Ω—é—î 0`);const c=s.–ö—ñ–ª—å–∫—ñ—Å—Ç—å*s.–¶—ñ–Ω–∞;(!c||c===0)&&e.push(`–î–µ—Ç–∞–ª—å ${t}: –°—É–º–∞ - –Ω–µ –ø–æ—Ä–æ–∂–Ω—è —ñ –Ω–µ –¥–æ—Ä—ñ–≤–Ω—é—î 0`);const n=document.querySelector(`#${k} tbody tr [data-name="pib_magazin"]`);n&&n.offsetParent!==null&&(!s.shopName||s.shopName.trim()==="")&&e.push(`–î–µ—Ç–∞–ª—å ${t}: –ü–Ü–ë_–ú–∞–≥–∞–∑–∏–Ω - –Ω–µ –ø–æ—Ä–æ–∂–Ω—ñ–π`)}return{isValid:e.length===0,errors:e}}async function x(e){const a=new Map,r=[];for(const n of e.detailRows){const i=(n.shopName||"").trim();i&&(n.sclad_id&&r.push(n.sclad_id),a.has(i)||a.set(i,[]),a.get(i).push({sclad_id:n.sclad_id,–ù–∞–π–º–µ–Ω—É–≤–∞–Ω–Ω—è:n.–ù–∞–π–º–µ–Ω—É–≤–∞–Ω–Ω—è,–ö–∞—Ç–∞–ª–æ–≥:n.–ö–∞—Ç–∞–ª–æ–≥,–ö—ñ–ª—å–∫—ñ—Å—Ç—å:n.–ö—ñ–ª—å–∫—ñ—Å—Ç—å,–¶—ñ–Ω–∞:n.–¶—ñ–Ω–∞}))}const s=await Y(r),{date_off:t}=await I(e.actId),c=A(t);for(const[n,i]of a.entries()){const o=await Q(n);if(!o){f(`–ú–∞–≥–∞–∑–∏–Ω "${n}" –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ —É shops ‚Äî –ø—Ä–æ–ø—É—â–µ–Ω–æ`,"warning",1800);continue}const l=[];for(const d of i){const u=d.sclad_id&&s.get(d.sclad_id)||null;l.push({sclad_id:d.sclad_id,–ö–∞—Ç–∞–ª–æ–≥:d.–ö–∞—Ç–∞–ª–æ–≥?isNaN(Number(d.–ö–∞—Ç–∞–ª–æ–≥))?d.–ö–∞—Ç–∞–ª–æ–≥:Number(d.–ö–∞—Ç–∞–ª–æ–≥):null,–¶—ñ–Ω–∞:Number(d.–¶—ñ–Ω–∞)||0,–†–∞—Ö—É–Ω–æ–∫:u?u.rahunok??null:null,–ö—ñ–ª—å–∫—ñ—Å—Ç—å:Number(d.–ö—ñ–ª—å–∫—ñ—Å—Ç—å)||0,–ù–∞–π–º–µ–Ω—É–≤–∞–Ω–Ω—è:d.–ù–∞–π–º–µ–Ω—É–≤–∞–Ω–Ω—è})}const p=ee(o);p[e.dateKey]||(p[e.dateKey]=[]);const h=p[e.dateKey];let m=h.find(d=>Number(d==null?void 0:d.–ê–∫—Ç)===Number(e.actId));m||(m={–ê–∫—Ç:e.actId,–î–µ—Ç–∞–ª—ñ:[],–î–∞—Ç–∞–ó–∞–∫—Ä–∏—Ç—Ç—è:c??null},h.push(m)),m.–î–µ—Ç–∞–ª—ñ=l,m.–î–∞—Ç–∞–ó–∞–∫—Ä–∏—Ç—Ç—è=c??null,await X(o)}}async function z(e){try{const{data:a,error:r}=await _.from("slyusars").select("*");if(r){console.warn("–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–∞–Ω—ñ –∑ slyusars:",r.message);return}if(!a||a.length===0)return;const s=Object.keys(a[0]||{}),t=["slyusar_id","id","slyusars_id","uid","pk"];let c=null;for(const o of t)if(s.includes(o)){c=o;break}if(!c){console.error("‚ùå –ù–µ –≤–¥–∞–ª–æ—Å—è –≤–∏–∑–Ω–∞—á–∏—Ç–∏ –ø–µ—Ä–≤–∏–Ω–Ω–∏–π –∫–ª—é—á –¥–ª—è slyusars"),console.error("üí° –î–æ—Å—Ç—É–ø–Ω—ñ –∫–ª—é—á—ñ:",s),console.error("üí° –®—É–∫–∞–ª–∏:",t);return}let n=0,i=0;for(const o of a){let l={};if(typeof o.data=="string")try{l=JSON.parse(o.data)}catch{console.warn(`‚ö†Ô∏è –ù–µ –≤–¥–∞–ª–æ—Å—è —Ä–æ–∑–ø–∞—Ä—Å–∏—Ç–∏ –¥–∞–Ω—ñ –¥–ª—è –∑–∞–ø–∏—Å—É ${o[c]}`);continue}else if(typeof o.data=="object"&&o.data!==null)l=o.data;else{console.warn(`‚ö†Ô∏è –ù–µ–≤–∞–ª—ñ–¥–Ω—ñ –¥–∞–Ω—ñ –¥–ª—è –∑–∞–ø–∏—Å—É ${o[c]}`);continue}if((l.–î–æ—Å—Ç—É–ø||"").toLowerCase().normalize("NFKC").trim()!=="–ø—Ä–∏–π–º–∞–ª—å–Ω–∏–∫"||(i++,!l.–Ü—Å—Ç–æ—Ä—ñ—è||typeof l.–Ü—Å—Ç–æ—Ä—ñ—è!="object"))continue;const m=l.–Ü—Å—Ç–æ—Ä—ñ—è;let d=!1;for(const u in m){if(!Array.isArray(m[u]))continue;const w=m[u];for(const g of w){const y=g==null?void 0:g.–ê–∫—Ç;if(Number(y)===Number(e.actId)){g.–î–∞—Ç–∞–ó–∞–∫—Ä–∏—Ç—Ç—è=e.dateClose,d=!0;break}}if(d)break}if(d){const{error:u}=await _.from("slyusars").update({data:l}).eq(c,o[c]);u?console.error(`‚ùå –ü–æ–º–∏–ª–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è slyusars#${o[c]}:`,u.message):n++}}n>0?f(`‚úÖ –Ü—Å—Ç–æ—Ä—ñ—è –ø—Ä–∏–π–º–∞–ª—å–Ω–∏–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω–∞ (${n})`,"success",2e3):(console.warn(`‚ö†Ô∏è –ê–∫—Ç ${e.actId} –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –≤ —ñ—Å—Ç–æ—Ä—ñ—ó –∂–æ–¥–Ω–æ–≥–æ –ø—Ä–∏–π–º–∞–ª—å–Ω–∏–∫–∞`),f(`‚ö†Ô∏è –ê–∫—Ç ${e.actId} –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ —É –ø—Ä–∏–π–º–∞–ª—å–Ω–∏–∫—ñ–≤`,"info",3e3))}catch(a){console.error("‚ùå –ü–æ–º–∏–ª–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó slyusars:",a),f("‚ùå –ü–æ–º–∏–ª–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó —ñ—Å—Ç–æ—Ä—ñ—ó –ø—Ä–∏–π–º–∞–ª—å–Ω–∏–∫–∞","error")}}const re=["–∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä","–∞–¥–º—ñ–Ω—ñ—Å—Ç–∞—Ç–æ—Ä","full","admin","administrator"];function se(){var s;const e=(typeof v=="string"?v:"")||"",a=((s=T)==null?void 0:s())||null;return(e||(a==null?void 0:a.access)||(a==null?void 0:a.–î–æ—Å—Ç—É–ø)||"").toString().normalize("NFKC").trim().toLowerCase()}function q(){return re.includes(se())}let L=!1;function le(){L||(L=!0,document.addEventListener("click",async e=>{var c,n,i;const a=e.target,r=(c=a==null?void 0:a.closest)==null?void 0:c.call(a,"#status-lock-btn");if(!r)return;const s=r.getAttribute("data-act-id"),t=s?Number(s):NaN;if(!Number.isFinite(t)){console.error("data-act-id –Ω–∞ –∫–Ω–æ–ø—Ü—ñ –≤—ñ–¥—Å—É—Ç–Ω—ñ–π/–Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏–π"),f("–ü–æ–º–∏–ª–∫–∞: –Ω–µ –≤–∏–∑–Ω–∞—á–µ–Ω–æ ID –∞–∫—Ç—É","error");return}if(!r.disabled){r.disabled=!0;try{if(v==="–°–ª—é—Å–∞—Ä"){if(S.isActClosed){f("–ê–∫—Ç –∑–∞–∫—Ä–∏—Ç–∏–π. –£ –í–∞—Å –≤—ñ–¥—Å—É—Ç–Ω—ñ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É –Ω–∞ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è –∞–∫—Ç—É. –ó–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞.","warning",4e3),r.disabled=!1;return}let o=!1;try{o=await B()}catch(b){console.error("–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø—Ä–∞–≤ –°–ª—é—Å–∞—Ä—è:",b)}if(!o){f("‚ùå –£ –≤–∞—Å –Ω–µ–º–∞—î –ø—Ä–∞–≤–∞ –¥–ª—è —Ü—ñ—î—ó —Ñ—É–Ω–∫—Ü—ñ—ó. –ó–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞.","warning",4e3),r.disabled=!1;return}const{data:l,error:p}=await _.from("acts").select("slusarsOn, pruimalnyk").eq("act_id",t).single();if(p){console.error("–ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –∞–∫—Ç—É:",p),f("–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Å—Ç–∞–Ω—É –∞–∫—Ç—É","error"),r.disabled=!1;return}const h=(l==null?void 0:l.slusarsOn)===!0,m=String(t),d=l==null?void 0:l.pruimalnyk;let u=!1;if(h?u=await F("–í—ñ–¥–º—ñ–Ω–∏—Ç–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ä–æ–±—ñ—Ç?"):u=await F("–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –≤—Å—ñ—Ö —Ä–æ–±—ñ—Ç?"),!u){f("–°–∫–∞—Å–æ–≤–∞–Ω–æ","warning"),r.disabled=!1;return}const w=!h,{error:g}=await _.from("acts").update({slusarsOn:w}).eq("act_id",t);if(g){console.error("–ü–æ–º–∏–ª–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è slusarsOn:",g),f("–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è","error"),r.disabled=!1;return}try{const b=(n=T)==null?void 0:n(),E=(b==null?void 0:b.name)||"–ù–µ–≤—ñ–¥–æ–º–∏–π",K=E.split(" ")[0]||E;await G(t,m,w,K,E,d)}catch(b){console.error("‚ö†Ô∏è –ü–æ–º–∏–ª–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ):",b)}const y=document.querySelector(".zakaz_narayd-header");y&&(w?y.classList.add("zakaz_narayd-header-slusar-on"):y.classList.remove("zakaz_narayd-header-slusar-on")),$(),f(w?"‚úÖ –†–æ–±–æ—Ç–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–æ":"‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ä–æ–±—ñ—Ç –≤—ñ–¥–º—ñ–Ω–µ–Ω–æ","success",2e3),r.disabled=!1;return}if(S.isActClosed){let o=!0;if(!q()){try{o=await M()}catch(w){console.error("–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø—Ä–∞–≤ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è –∞–∫—Ç—É:",w),o=!1}if(!o){f("‚ùå –£ –≤–∞—Å —Ü—è —Ñ—É–Ω–∫—Ü—ñ—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞. –ó–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞.","warning",4e3),r.disabled=!1;return}}if(!await W(t)){f("–°–∫–∞—Å–æ–≤–∞–Ω–æ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è –∞–∫—Ç—É","warning"),r.disabled=!1;return}f("–í—ñ–¥–∫—Ä–∏—Ç—Ç—è –∞–∫—Ç—É...","info");const{data:p,error:h}=await _.from("sclad").select("sclad_id").eq("akt",t);if(h)throw new Error("–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –∑–∞–ø–∏—Å–∏ —Å–∫–ª–∞–¥—É: "+h.message);if(p&&p.length>0){const{error:w}=await _.from("sclad").update({time_off:null}).eq("akt",t);if(w)throw new Error("–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—á–∏—Å—Ç–∏—Ç–∏ time_off: "+w.message)}const{error:m}=await _.from("acts").update({date_off:null,tupOplatu:null}).eq("act_id",t);if(m)throw new Error("–ù–µ –≤–¥–∞–ª–æ—Å—è –≤—ñ–¥–∫—Ä–∏—Ç–∏ –∞–∫—Ç: "+m.message);const{date_on:d}=await I(t),u=A(d);if(u){const w=D();w.length&&await x({actId:t,dateKey:u,detailRows:w}),await z({actId:t,dateKey:u,dateClose:null})}else f("–ù–µ –≤–¥–∞–ª–æ—Å—å –≤–∏–∑–Ω–∞—á–∏—Ç–∏ –¥–∞—Ç—É –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è –∞–∫—Ç—É ‚Äî –Ü—Å—Ç–æ—Ä—ñ—è –≤ shops –Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–∞","warning",2e3);S.isActClosed=!1,await R(),await O(t,"client"),$(),f("–ê–∫—Ç —É—Å–ø—ñ—à–Ω–æ –≤—ñ–¥–∫—Ä–∏—Ç–æ","success")}else{let o=!0;if(!q())if(P()){try{o=await V()}catch(b){console.error("–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø—Ä–∞–≤ –∑–∞–∫—Ä–∏—Ç—Ç—è –∞–∫—Ç—É:",b),o=!0}if(!o){f("–£ –≤–∞—Å –Ω–µ–º–∞—î –ø—Ä–∞–≤–∞ –∑–∞–∫—Ä–∏–≤–∞—Ç–∏ –∞–∫—Ç–∏. –ó–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞.","warning",4e3),r.disabled=!1;return}}else{try{o=await j()}catch(b){console.error("–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø—Ä–∞–≤ –∑–∞–∫—Ä–∏—Ç—Ç—è –∞–∫—Ç—É:",b),o=!0}if(!o){f("–£ –≤–∞—Å –Ω–µ–º–∞—î –ø—Ä–∞–≤–∞ –∑–∞–∫—Ä–∏–≤–∞—Ç–∏ –∞–∫—Ç–∏ —ñ–∑ –∑–∞—É–≤–∞–∂–µ–Ω–Ω—è–º–∏. –ó–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞.","warning",4e3),r.disabled=!1;return}}if(!q()){const y=ae();if(!y.isValid){f("‚ùå –ó–∞–∫—Ä–∏—Ç—Ç—è –≤—ñ–¥–º—ñ–Ω–µ–Ω–æ, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –ø–æ–ª—è —Ç–∞–±–ª–∏—Ü—ñ","error",5e3),console.warn("–ü–æ–º–∏–ª–∫–∏ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó —Ç–∞–±–ª–∏—Ü—ñ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä–∏—Ç—Ç—è–º:",y.errors),y.errors.forEach(b=>{console.warn(`  ‚Ä¢ ${b}`)}),r.disabled=!1;return}}if((i=document.getElementById(U))==null||i.click(),!await Z(t)){f("–°–∫–∞—Å–æ–≤–∞–Ω–æ –∑–∞–∫—Ä–∏—Ç—Ç—è –∞–∫—Ç—É","warning"),r.disabled=!1;return}f("–ó–∞–∫—Ä–∏—Ç—Ç—è –∞–∫—Ç—É...","info");const{data:p,error:h}=await _.from("sclad").select("sclad_id").eq("akt",t);if(h)throw new Error("–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –∑–∞–ø–∏—Å–∏ —Å–∫–ª–∞–¥—É: "+h.message);const m=new Date().toISOString();if(p&&p.length>0){const{error:y}=await _.from("sclad").update({time_off:m}).eq("akt",t);if(y)throw new Error("–ù–µ –≤–¥–∞–ª–æ—Å—è –æ–Ω–æ–≤–∏—Ç–∏ time_off: "+y.message)}const{error:d}=await _.from("acts").update({date_off:m,slusarsOn:!1}).eq("act_id",t);if(d)throw new Error("–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–∫—Ä–∏—Ç–∏ –∞–∫—Ç: "+d.message);try{await J(t)}catch(y){console.error("‚ö†Ô∏è –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏—Ö–æ–≤—É–≤–∞–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ):",y)}try{await H(t)}catch(y){console.error("‚ö†Ô∏è –ü–æ–º–∏–ª–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –ø—Ä–æ –∑–º—ñ–Ω–∏ (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ):",y)}const{date_on:u}=await I(t),w=A(u),g=A(m);if(w){const y=D();y.length&&await x({actId:t,dateKey:w,detailRows:y}),await z({actId:t,dateKey:w,dateClose:g})}else f("–ù–µ –≤–¥–∞–ª–æ—Å—å –≤–∏–∑–Ω–∞—á–∏—Ç–∏ –¥–∞—Ç—É –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è –∞–∫—Ç—É ‚Äî –Ü—Å—Ç–æ—Ä—ñ—è –≤ shops –Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–∞","warning",2e3);S.isActClosed=!0,await R(),await O(t,"client"),$(),f("–ê–∫—Ç —É—Å–ø—ñ—à–Ω–æ –∑–∞–∫—Ä–∏—Ç–æ","success")}}catch(o){console.error("–ü–æ–º–∏–ª–∫–∞ –≤ –æ–±—Ä–æ–±–Ω–∏–∫—É —Å—Ç–∞—Ç—É—Å-–∑–∞–º–∫–∞:",o),f("–ü–æ–º–∏–ª–∫–∞: "+((o==null?void 0:o.message)||o),"error")}finally{r.disabled=!1}}}))}export{le as initStatusLockDelegation};
