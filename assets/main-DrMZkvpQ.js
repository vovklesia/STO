var f=Object.defineProperty;var I=(t,e,a)=>e in t?f(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a;var i=(t,e,a)=>I(t,typeof e!="symbol"?e+"":e,a);import{s as l}from"./project.config-DUfbQKeR.js";import{g as h,i as y,a as g,l as w,b as c,c as S,s as k,u as b}from"./main-lEEsSsVM.js";import"./supabase-DjCBILTv.js";import"./pdf-yBvge-Eo.js";async function D(t){if(!t)return!1;try{const{data:e,error:a}=await l.from("whitelist").select("email").eq("email",t.toLowerCase()).single();return(a==null?void 0:a.code)==="PGRST116"?!1:a?(console.error("❌ Помилка whitelist:",a),!1):!!e}catch(e){return console.error("❌ Виняток whitelist:",e),!1}}async function Y(){try{const{data:{session:t},error:e}=await l.auth.getSession();if(e||!t){console.warn("⛔ [Main] Немає Google сесії"),alert("Сесія закінчилась. Увійдіть знову.");const n=await h("index.html");window.location.replace(n);return}const a=t.user.email;if(!await D(a)){console.warn("⛔ [Main] Email не в whitelist:",a),await l.auth.signOut();const n=await h();window.location.replace(n);return}y()}catch(t){console.error("❌ [Main] Помилка перевірки:",t);const e=await g("index.html");window.location.replace(e)}}Y();class v{constructor(){i(this,"searchIcon");i(this,"searchInput");i(this,"onSearchCallback");if(this.searchIcon=document.getElementById("searchIcon"),this.searchInput=document.getElementById("searchInput"),!this.searchIcon||!this.searchInput){console.error("❌ Елементи пошуку не знайдено в DOM");return}this.initSearch()}initSearch(){this.searchInput&&(this.searchInput.style.width="0",this.searchInput.style.padding="0",this.searchInput.style.opacity="0",this.searchInput.style.visibility="hidden",this.searchInput.style.transition="all 0.3s ease",this.bindEvents())}bindEvents(){!this.searchIcon||!this.searchInput||(this.searchIcon.addEventListener("click",()=>this.toggleSearchInput()),this.searchInput.addEventListener("input",()=>this.handleSearchInput()),this.searchInput.addEventListener("keydown",e=>{e.key==="Escape"&&this.hideSearchInput()}))}toggleSearchInput(){if(!this.searchInput)return;this.searchInput.style.width==="0px"||this.searchInput.style.width==="0"||this.searchInput.style.visibility==="hidden"?this.showSearchInput():this.hideSearchInput()}showSearchInput(){this.searchInput&&(this.searchInput.style.visibility="visible",this.searchInput.style.width="200px",this.searchInput.style.padding="3px 7px",this.searchInput.style.opacity="1",setTimeout(()=>{var e;(e=this.searchInput)==null||e.focus()},300))}hideSearchInput(){this.searchInput&&(this.searchInput.style.width="0",this.searchInput.style.padding="0",this.searchInput.style.opacity="0",setTimeout(()=>{this.searchInput&&(this.searchInput.style.visibility="hidden",this.searchInput.value="",this.onSearchCallback&&this.onSearchCallback(""))},300))}handleSearchInput(){if(!this.searchInput)return;const e=this.searchInput.value.trim();this.onSearchCallback&&this.onSearchCallback(e)}setSearchCallback(e){this.onSearchCallback=e}setSearchValue(e){this.searchInput&&(this.searchInput.value=e,this.onSearchCallback&&this.onSearchCallback(e))}getSearchValue(){var e;return((e=this.searchInput)==null?void 0:e.value.trim())||""}clearSearch(){this.searchInput&&(this.searchInput.value="",this.onSearchCallback&&this.onSearchCallback(""))}isSearchOpen(){return this.searchInput?this.searchInput.style.width!=="0px"&&this.searchInput.style.width!=="0":!1}}function M(t,e,a){const s=new v;return s.setSearchCallback(n=>{const r=e(),{dateFrom:o,dateTo:p}=a();r==="open"?t(null,null,"open",n):r==="closed"?t(null,null,"closed",n):t(o,p,null,n)}),s}window.logoutFromSystemAndRedirect=w;function d(){const t=localStorage.getItem("userAuthData");if(!t)return!1;try{const e=JSON.parse(t);return!!(e.Name&&e.Доступ)}catch{return!1}}function u(t){return d()?!1:(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),alert("⛔ Доступ заблоковано. Ви не авторизовані."),!0)}function C(t){const e=document.getElementById("menu-items-to-hide");e&&(e.style.display="flex")}function E(){try{const t=localStorage.getItem("userAuthData");if(t){const e=JSON.parse(t),a=document.getElementById("userInfoBlock"),s=document.querySelector(".user-surname"),n=document.querySelector(".user-access");s&&(s.textContent=e.Name),n&&(n.textContent=e.Доступ),a&&(a.style.display="flex")}}catch(t){console.error(t)}}function O(){$("#searchInput").on("focus click keydown",function(t){u(t)&&$(this).blur()}),$("#dateRangePicker").on("show.daterangepicker",function(t,e){d()||(e.hide(),t.preventDefault(),alert("⛔ Доступ до календаря заблоковано. Ви не авторизовані."))}),$("#dateRangePicker").on("click focus",function(t){u(t)&&$(this).blur()})}function m(){let t="open";O(),$(document).on("click",function(s){if(!$(s.target).closest(".search-container").length){const n=$("#searchInput");n.hasClass("active")&&n.val()===""&&n.removeClass("active")}}),$("#dateRangePicker").daterangepicker({locale:{format:"DD.MM.YYYY",separator:" - ",applyLabel:"Прийняти",cancelLabel:"Відмінити",fromLabel:"Від",toLabel:"До",weekLabel:"Тиж",daysOfWeek:["Нд","Пн","Вт","Ср","Чт","Пт","Сб"],monthNames:["Січень","Лютий","Березень","Квітень","Травень","Червень","Липень","Серпень","Вересень","Жовтень","Листопад","Грудень"],firstDay:1},opens:"center",alwaysShowCalendars:!0,autoUpdateInput:!1,startDate:moment().startOf("year"),endDate:moment(),ranges:{Відкриті:[moment().startOf("year"),moment()],Закриті:[moment("02.01.2025","DD.MM.YYYY"),moment()],"Від початку":[moment("03.01.2025","DD.MM.YYYY"),moment()],Сьогодні:[moment(),moment()],"Останні 7 днів":[moment().subtract(6,"days"),moment()],"Поточний місяць":[moment().startOf("month"),moment().endOf("month")],"Минулий місяць":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]},showCustomRangeLabel:!1},function(s,n,r){if(r==="Відкриті")$("#dateRangePicker").val("Відкриті"),$("#dateRangePicker").data("daterangepicker").element.removeClass("active-range"),t="open",c(null,null,"open"),this.setStartDate(moment().startOf("year")),this.setEndDate(moment());else if(r==="Закриті")$("#dateRangePicker").val("Закриті"),$("#dateRangePicker").data("daterangepicker").element.removeClass("active-range"),t="closed",c(null,null,"closed"),this.setStartDate(moment("02.01.2025","DD.MM.YYYY")),this.setEndDate(moment());else{const o=`${s.format("DD.MM.YYYY")} - ${n.format("DD.MM.YYYY")}`;$("#dateRangePicker").val(o),$("#dateRangePicker").data("daterangepicker").element.addClass("active-range"),t="date_range",c(s.format("YYYY-MM-DD 00:00:00"),n.format("YYYY-MM-DD 23:59:59"),null)}}),$("#dateRangePicker").val("Відкриті"),t="open";const e=$("#dateRangePicker").data("daterangepicker");e&&(e.setStartDate(moment().startOf("year")),e.setEndDate(moment()));const a=M(c,()=>t,()=>({dateFrom:null,dateTo:null}));window.searchHandler=a,S(),C()}window.initializeSystem=m;async function P(){const t=await k();t?(await b(t),E(),m()):console.error("❌ Вхід не вдалося здійснити.")}P();
